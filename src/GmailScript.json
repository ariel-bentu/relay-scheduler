{"files":[{"id":"7a0505b9-1896-4727-9418-6d5e03e0d575","name":"Code","type":"server_js","source":"\nfunction getItems() {\n  var now \u003d new Date();\n  \n  // set time to some convenient value\n  now.setHours(0,0,0,0);\n\n  // Get the begining of the week\n  var sunday \u003d new Date(now);\n  sunday.setDate(sunday.getDate() - sunday.getDay() + 1);\n\n  \n  var offset \u003d 7*24*60*60*1000;\n  var inAWeek \u003d new Date(sunday.getTime() + offset);\n \n  var cal \u003d CalendarApp.getCalendarsByName(\"Sprinklers\")[0];\n  return cal.getEvents(sunday, inAWeek);\n}\n  \n  \nfunction doGet(e) {\n  var eTag \u003d e.parameter[\"eTag\"];\n  return exec(eTag);\n}\n\nfunction exec(eTag) {\n  var items \u003d getItems();\n\n  var result \u003d \"\" + items.length + \" \";\n\n  for (var i\u003d0;i\u003citems.length;i++) {\n    var item \u003d items[i];\n    \n    var relays \u003d item.getTitle();\n    \n    var startDay \u003d item.getStartTime().getDay() + 1;\n    var startHour \u003d item.getStartTime().getHours();\n    var startMin \u003d item.getStartTime().getMinutes();\n    var durationMin \u003d Math.round((item.getEndTime() - item.getStartTime()) / 60000);\n    var recurrent \u003d item.isRecurringEvent() ? \"1\" : \"0\";\n    \n    //support multiple relays in one event, comma seperated\n    var relayIDs \u003d relays.split(\",\");\n    for (var j\u003d0;j\u003crelayIDs.length;j++) {\n      result +\u003d relayIDs[j] +\" \"+ startDay + \" \" + startHour +\":\"+ startMin +\" \" + durationMin +\" \"+ recurrent +\" \";\n    }\n  }\n  \n  var eTagNew \u003d MD5(result, true);\n  if (eTagNew \u003d\u003d eTag) \n    result \u003d \"\"\n  \n  \n  return ContentService.createTextOutput(eTagNew + \"||\" + result);\n}\n\n\nfunction MD5( input, isShortMode )\n{\n    var txtHash \u003d \u0027\u0027;\n    var rawHash \u003d Utilities.computeDigest(\n                      Utilities.DigestAlgorithm.MD5,\n                      input,\n                      Utilities.Charset.UTF_8 );\n\n    var isShortMode \u003d ( isShortMode \u003d\u003d true ) ? true : false;\n \n    if ( ! isShortMode ) {\n        for ( i \u003d 0; i \u003c rawHash.length; i++ ) {\n\n            var hashVal \u003d rawHash[i];\n\n            if ( hashVal \u003c 0 ) {\n                hashVal +\u003d 256;\n            };\n            if ( hashVal.toString( 16 ).length \u003d\u003d 1 ) {\n                txtHash +\u003d \u00270\u0027;\n            };\n            txtHash +\u003d hashVal.toString( 16 );\n        };\n    } else {\n        for ( j \u003d 0; j \u003c 16; j +\u003d 8 ) {\n\n            hashVal \u003d ( rawHash[j]   + rawHash[j+1] + rawHash[j+2] + rawHash[j+3] )\n                    ^ ( rawHash[j+4] + rawHash[j+5] + rawHash[j+6] + rawHash[j+7] );\n\n            if ( hashVal \u003c 0 ) {\n                hashVal +\u003d 1024;\n            };\n            if ( hashVal.toString( 36 ).length \u003d\u003d 1 ) {\n                txtHash +\u003d \"0\";\n            };\n\n            txtHash +\u003d hashVal.toString( 36 );\n        };\n    };\n\n    // change below to \"txtHash.toLowerCase()\" for lower case result.\n    return txtHash.toUpperCase();\n\n}"},{"id":"863fad8e-32a4-4f21-8b18-47a47900d247","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Jerusalem\",\n  \"dependencies\": {\n    \"enabledAdvancedServices\": [{\n      \"userSymbol\": \"Calendar\",\n      \"serviceId\": \"calendar\",\n      \"version\": \"v3\"\n    }]\n  },\n  \"webapp\": {\n    \"access\": \"ANYONE_ANONYMOUS\",\n    \"executeAs\": \"USER_DEPLOYING\"\n  },\n  \"exceptionLogging\": \"STACKDRIVER\"\n}"}]}